[build]
builder = "NIXPACKS"
buildCommand = "cd ../.. && pnpm install && pnpm --filter web build"

[deploy]
startCommand = "cd ../.. && pnpm --filter web start"
healthcheckPath = "/"
healthcheckTimeout = 300
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 3

[build.nixpacks]
providers = ["node"]
aptPkgs = ["curl"]

[phases.setup]
nixPkgs = ["nodejs_20", "pnpm"]

[phases.install]
cmds = ["cd ../.. && pnpm install --frozen-lockfile"]
